<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>RiderSkill — VOD récentes</title>
<link rel="icon" href="https://unavatar.io/twitch/riderskill" />
<meta name="theme-color" content="#0D0D0D" />
<style>
:root{ --bg:#0f1014; --panel:#161616; --line:#242424; --text:#EDEDED; --muted:#9aa0a6; }
*{box-sizing:border-box} html,body{margin:0;padding:0}
body{
  min-height:100vh;color:var(--text);
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial;
  background:
    radial-gradient(ellipse at 50% 15%, rgba(255,255,255,.10) 0%, rgba(255,255,255,.05) 30%, rgba(0,0,0,.35) 65%, rgba(0,0,0,.60) 100%),
    url("https://images.unsplash.com/photo-1542751371-adc38448a05e?q=80&w=1920&auto=format&fit=crop") center/cover no-repeat fixed,
    var(--bg);
}
a{color:inherit;text-decoration:none}
.container{width:100%;max-width:1120px;margin:0 auto;padding:0 16px}
.section{padding:26px 0}
.muted{color:var(--muted)}
.topbar{position:sticky;top:0;z-index:1000;background:rgba(13,13,13,.86);backdrop-filter:saturate(160%) blur(8px);border-bottom:1px solid #1f1f1f}
.nav{display:flex;align-items:center;justify-content:space-between;gap:12px;min-height:64px}
.brand{display:flex;align-items:center;gap:10px;white-space:nowrap}
.brand-avatar{width:28px;height:28px;border-radius:6px;box-shadow:0 0 0 2px rgba(0,0,0,.35)}
#brandText{font-weight:900}
.links{display:flex;flex-wrap:wrap;gap:10px;align-items:center}
.btn{padding:10px 14px;background:rgba(26,26,26,.92);border:1px solid #2a2a2a;border-radius:14px;
  font-weight:800;display:inline-flex;align-items:center;gap:8px;transition:transform .18s,background .18s,border-color .18s,box-shadow .18s}
.btn:hover{transform:translateY(-1px);background:#202020;border-color:#3a3a3a;box-shadow:0 8px 22px rgba(0,0,0,.28)}
.panel{background:linear-gradient(180deg, rgba(24,24,24,.94), rgba(24,24,24,.90));border:1px solid #1f1f1f;border-radius:22px;padding:22px;box-shadow:0 12px 30px rgba(0,0,0,.38)}
h1{margin:0 0 10px 0;font-size:2rem;font-weight:900}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:16px}
.card{background:#141414;border:1px solid #222;border-radius:14px;overflow:hidden;display:flex;flex-direction:column}
.thumb{position:relative;padding-top:56.25%;background:#0b0b0b}
.thumb iframe{position:absolute;inset:0;width:100%;height:100%;border:0}
.card .body{padding:12px;display:flex;flex-direction:column;gap:6px}
.title{font-weight:800}
.meta{font-size:.9rem;color:var(--muted)}
.actions{margin-top:8px}
.actions .btn{width:100%;justify-content:center}
.note{margin-top:12px}
.error{color:#ef4444;font-weight:800}
footer{opacity:.9;padding:28px 0;text-align:center;color:var(--muted)}
</style>
</head>
<body>
<div class="topbar">
  <div class="nav container">
    <a class="brand" href="/riderskill-site/index.html" title="Accueil">
      <img class="brand-avatar" src="https://unavatar.io/twitch/riderskill" alt="Logo RiderSkill">
      <span id="brandText">RiderSkill</span>
    </a>
    <div class="links">
      <a class="btn" href="/riderskill-site/index.html">Live</a>
      <a class="btn" href="/riderskill-site/clips.html">Clips</a>
      <a class="btn" href="/riderskill-site/alaune.html">À la une</a>
      <a class="btn" href="https://www.twitch.tv/riderskill/videos?filter=archives&sort=time" target="_blank" rel="noopener">Toutes les VOD sur Twitch</a>
    </div>
  </div>
</div>

<section class="section container">
  <div class="panel">
    <h1>VOD récentes</h1>
    <p class="muted">Auto via Google Sheets (si configuré) → sinon via <code>vod.json</code>.</p>
    <div id="vods" class="grid"></div>
    <p id="emptyMsg" class="muted note" style="display:none">Aucune VOD.</p>
    <p id="errMsg" class="error note" style="display:none"></p>
  </div>
</section>

<footer class="container">© 2025 RiderSkill — twitch.tv/riderskill · kick.com/riderskill</footer>

<script>
const SHEET_CSV_URL = ""; // URL CSV de ton Sheets si tu veux l’auto-MAJ. Sinon vide => /riderskill-site/vod.json
const PARENT_HOST = "riderskill.github.io";
const bust = Date.now();

function parseCSV(text){ return text.split(/\r?\n/).filter(Boolean).map(l=>l.split(",")); }
function normalize(v){
  return {
    title:(v.title||"VOD").trim(),
    url:(v.url||"").trim(),
    date:v.date? new Date(v.date): null,
    platform:(v.platform||"").trim()
  };
}
function embedFromUrl(url){
  try{
    const u=new URL(url);
    // Twitch VOD: https://www.twitch.tv/videos/XXXXXXXX
    if(/twitch\.tv$/i.test(u.hostname) && u.pathname.startsWith("/videos/")){
      const id=u.pathname.split("/").pop();
      return `https://player.twitch.tv/?video=${id}&parent=${PARENT_HOST}&autoplay=false&muted=false`;
    }
    // YouTube vidéo
    if(/(youtube\.com|youtu\.be)$/i.test(u.hostname)){
      let id=""; if(u.hostname.includes("youtu.be")) id=u.pathname.slice(1); else id=u.searchParams.get("v")||"";
      if(id) return `https://www.youtube.com/embed/${id}`;
    }
    return url;
  }catch{ return url; }
}
function fmtDate(d){ try{ return d? d.toLocaleString('fr-FR') : ""; }catch{ return ""; } }

function render(list){
  const grid=document.getElementById('vods');
  const empty=document.getElementById('emptyMsg');
  const err=document.getElementById('errMsg');
  err.style.display='none';
  if(!list.length){ grid.innerHTML=""; empty.style.display='block'; return; }
  empty.style.display='none';
  grid.innerHTML=list.map(v=>{
    const src=embedFromUrl(v.url);
    const meta=[fmtDate(v.date), v.platform].filter(Boolean).join(" · ");
    return `
      <div class="card">
        <div class="thumb"><iframe src="${src}" allowfullscreen></iframe></div>
        <div class="body">
          <div class="title">${(v.title||"VOD").replace(/</g,'&lt;')}</div>
          <div class="meta">${meta}</div>
          <div class="actions"><a class="btn" href="${v.url}" target="_blank" rel="noopener">Ouvrir</a></div>
        </div>
      </div>`;
  }).join('');
}

async function loadFromSheet(){
  const r=await fetch(SHEET_CSV_URL,{cache:'no-store'}); if(!r.ok) throw new Error('Sheets HTTP '+r.status);
  const csv=await r.text(); const rows=parseCSV(csv); if(!rows.length) return [];
  const head=rows.shift().map(h=>h.trim().toLowerCase());
  const ti=head.indexOf("title"), ui=head.indexOf("url"), di=head.indexOf("date"), pi=head.indexOf("platform");
  return rows.map(r=>normalize({title:r[ti]||"",url:r[ui]||"",date:r[di]||"",platform:r[pi]||""})).filter(v=>v.url);
}
async function loadFromJson(){
  const r=await fetch('/riderskill-site/vod.json?v='+bust,{cache:'no-store'}); if(!r.ok) throw new Error('JSON HTTP '+r.status);
  const arr=await r.json(); if(!Array.isArray(arr)) return []; return arr.map(normalize).filter(v=>v.url);
}

async function load(){
  const err=document.getElementById('errMsg');
  try{
    let list=[];
    if(SHEET_CSV_URL){
      list=await loadFromSheet();
      if(!list.length){ try{ list=await loadFromJson(); }catch{} }
    }else{
      list=await loadFromJson();
    }
    render(list);
  }catch(e){
    err.textContent="Impossible de charger les VOD ("+e.message+").";
    err.style.display='block';
  }
}
load();
</script>
</body>
</html>
